---
title: "Bazaar.com"
subtitle: "Assessing the Effectiveness of Sponsored Search Engine Searches"
author: "Anthony Meyers, Danny Moncada, Jack Quick, Kevin Grady, Michael Brucek"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: pdf_document
---

## Executive Summary
The Bazaar.com sponsored search ROI is about 205%, not 320% as reported earlier. This is based on the treatment effect of having removed sponsored ad searches from Google.com. A 320% ROI calculation includes revenue generated from all ad sources and the expenses of the sponsored ad search. Estimating the true portion of clicks generated by the sponsored ads must take into account that sponsored searches and organic searches are substitute options for some users. This can be done using a difference in difference model.

## Problem Statement

The experiment conducted by Bazaar intended to measure the effectiveness of sponsored advertisements across an assortment of search engines. Prior ad analysis provided several key findings. First, the average cost of a sponsored ad click is $0.60. Also, the average conversion rate of customers who land on the site is approximately 12%, regardless of how they got there. Finally, the average net revenue per conversion is \$21. Bob's ROI calculation incorrectly uses these three measures to calculate ROI by overstating the revenue from users who would have clicked on the Bazaar.com result regardless of a sponsored ad, thus drastically inflating the ROI calculation.

Bazaar suspended their sponsored advertisement campaigns on the Google search engine at the beginning of the 10th week of data collection due to a technical glitch. The panel data Bazaar captured can be leveraged as an experimental design to estimate the true impact of sponsored ads. The **treatment** for this experiment is the _absence_ of sponsored advertisements, while the **control** will be the continued presence of sponsored advertisements. The unit of observation are the search engines on which Bazaar is currently paying to advertise. Google is the treatment group due to the previously mentioned technical glitch which resulted in the suspension of sponsored advertisements. Yahoo!, Ask.com, and Bing are control group since sponsored advertisements were run consistently on these sites without interruption for the duration of the panel.

## First Difference Estimate

One approach for estimating post-treatment change would be to calculate the first difference. First difference would be defined as the % change in web traffic to Bazaar.com arriving from Google. This estimate is the pre vs. post difference in the treated cohort. Estimating the treatment effect could be done using a regression.  However, it is unwise to solely rely on this estimate as our estimate of the treatment effect because it only quantifies the pre and post treatment differences.  We need to account for the differences across the websites, as our treatment is Google and our control groups are the remaining search engines.

```{r libraries and data, echo = FALSE}

suppressWarnings(suppressPackageStartupMessages({
library(dplyr)
library(ggplot2)
library(stargazer)
library(plm)
}))

ads <- read.csv("did_sponsored_ads.csv")
```

```{r total traffic graph code, echo = FALSE}

ads$search_engine_full <- ifelse(ads$search_engine == 'ask', 'Ask', ifelse(ads$search_engine == 'bing', 'Bing', ifelse(ads$search_engine == 'yahoo', 'Yahoo', ifelse(ads$search_engine == 'goog', 'Google', 0))))

p1 <- ggplot(ads, aes(x = week, y = tot_traffic, color = as.factor(search_engine_full))) + geom_line() + geom_vline(xintercept = 9, linetype = 'dotted') + theme_classic() + labs(title = 'Total Web Traffic by Search Engine', color = 'Search Engine', x = 'Week', y = 'Total web traffic')
```

```{r total traffic graph, echo = FALSE}

p1

```

From the visual provided above, it is obvious that total web traffic on Bazaar.com that originated with Google decreases after the sponsored advertisement campaign is suspended after Week 9. 

```{r data engineering, echo = FALSE}

ads <- ads %>% mutate(after_treatment = ifelse(week<10, 0, 1), treatment = ifelse(search_engine=='goog', 1, 0))

```
 

```{r first diff est - as percentage, results='hide'}

goog <- ads %>% filter(search_engine == 'goog')
goog_pre <- goog %>% filter(after_treatment == 0)
goog_post <- goog %>% filter(after_treatment == 1)

(mean(goog_post$tot_traffic) - mean(goog_pre$tot_traffic)) / mean(goog_pre$tot_traffic) *100

```

Google-originated traffic to Bazaar's website decreased by 14.9% once the sponsored advertisement campaign was suspended after Week 9.

```{r pre-post goog treat est, echo = FALSE}

lm1 <- lm(tot_traffic~as.factor(after_treatment), data = goog)

```

Using a linear model, one can see that total traffic from Google to Bazaar.com decreased by an average of  about 23,399 visits per week once the sponsored campaign was suspended.

```{r}

summary(lm1)

# Calculate the difference in total traffic pre & post treatment
# This is our first difference.
mean(goog_post$tot_traffic) - mean(goog_pre$tot_traffic)
```

It is important to estimate the value of sponsored advertisements in an experiment where the treatment group did not receive any sponsored advertisements post-treatment. Organic traffic was used to estimate the value of sponsored advertisements. Any increase or decrease in organic visits will be attributed directly to visits that would have normally came from sponsored links. The assumption is that the process that results in organic site visits *does not change* after the introduction of the treatment.

## Difference-in-Difference Model

A difference-in-difference model can be used to examine the increase in organic search traffic within the treatment period. This allows for estimation of web traffic that would have found bazaar.com through either a sponsored ad search or an organic search. The coefficient from the treatment:after_treatment component in the model is 8,545. This represents the change in Google organic search traffic during the treatment period. In other words, this traffic would have found Bazaar.com either way and shouldn't be included in the revenue portion of the ROI calculation for paid search advertising because their purchase isn't predicated on viewing an ad. That said, the expenses incurred as a result of their clicks on a paid ad must be kept in the expense portion of the ROI calculation because Bazaar was charged for those clicks.


```{r}

lm_org_did <- lm(avg_org ~ treatment*after_treatment, data = ads)
summary(lm_org_did)

```

A difference in difference regression model can be used to estimate the true number of users that were affected by the paid search program. This model considers two unique differences. First, it looks at the before and after change in total web traffic to Bazaar.com originating from Google and the control groups before and after the the treatment. This shows the impact of the Google search engine specifically. The output below shows the estimate of this effect is 22,785 visits per week.

```{r}

lm_did <- lm(tot_traffic ~ factor(search_engine)*after_treatment, data = ads)
summary(lm_did)

```

## Conclusion

The original ROI calculation fails to account for the web traffic from Google that would eventually find its way to Bazaar.com. A portion of this web traffic, estimated at 8,454 clicks, would have found bazaar.com through either paid search or organic search. 

The treatment effect from the Google searches should be used to determine the true ROI for paid ads. The true number of searches driven by the paid search advertising is 22,785, per the difference-in-difference model provided in this report. 

Previous analysis provided a 12% web conversion rate, an average net profit of \$21 per web conversion, a \$0.60 cost per paid search click. This analysis adds that the true average weekly amount of clicks affected by the paid search is 22,785. Also, the average number of paid search traffic clicks per week is as well as 31,333. Combining all these variables into a single ROI calculation becomes:  

	$$\frac{22,785 * .12 *21 }{0.6*31,333}= 2.054$$ 
	
The true ROI of paid ads is 205.4%
