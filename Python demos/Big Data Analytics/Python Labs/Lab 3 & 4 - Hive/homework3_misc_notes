CREATE EXTERNAL TABLE flight_data_csv (YEAR INT, MONTH TINYINT, DAY_OF_MONTH TINYINT, FL_DATE STRING, UNIQUE_CARRIER STRING, AIRLINE_ID INT, CARRIER STRING, TAIL_NUM STRING, FL_NUM STRING, ORIGIN_AIRPORT_ID INT, ORIGIN_AIRPORT_SEQ_ID INT, ORIGIN STRING, DEST_AIRPORT_ID INT, DEST_AIRPORT_SEQ_ID INT, DEST STRING, DEP_DELAY FLOAT, ARR_DELAY FLOAT, CANCELLED FLOAT, DIVERTED FLOAT, DISTANCE FLOAT) ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde' WITH SERDEPROPERTIES ("separatorChar" = "\t", "quoteChar" = "\"") LOCATION '/user/cloudera/flights/' TBLPROPERTIES("skip.header.line.count"="1");

CREATE EXTERNAL TABLE flight_data_csv (YEAR STRING, MONTH TINYINT, DAY_OF_MONTH TINYINT, FL_DATE STRING, UNIQUE_CARRIER STRING, AIRLINE_ID INT, CARRIER STRING, TAIL_NUM STRING, FL_NUM STRING, ORIGIN_AIRPORT_ID INT, ORIGIN_AIRPORT_SEQ_ID INT, ORIGIN STRING, DEST_AIRPORT_ID INT, DEST_AIRPORT_SEQ_ID INT, DEST STRING, DEP_DELAY FLOAT, ARR_DELAY FLOAT, CANCELLED FLOAT, DIVERTED FLOAT, DISTANCE FLOAT) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' LINES TERMINATED BY '\n' LOCATION '/user/cloudera/flights/';

LOAD DATA INPATH '/user/cloudera/flights/all_flights_csv' OVERWRITE INTO TABLE flight_data_csv;

CREATE EXTERNAL TABLE flight_data_raw (YEAR STRING, MONTH STRING, DAY_OF_MONTH STRING, FL_DATE STRING, UNIQUE_CARRIER STRING, AIRLINE_ID STRING, CARRIER STRING, TAIL_NUM STRING, FL_NUM STRING, ORIGIN_AIRPORT_ID STRING, ORIGIN_AIRPORT_SEQ_ID STRING, ORIGIN STRING, DEST_AIRPORT_ID STRING, DEST_AIRPORT_SEQ_ID STRING, DEST STRING, DEP_DELAY STRING, ARR_DELAY STRING, CANCELLED STRING, DIVERTED STRING, DISTANCE STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' LOCATION '/user/cloudera/flights/' TBLPROPERTIES("skip.header.line.count"="1");

CREATE TABLE flight_data_parquet (YEAR INT, FL_DATE STRING, UNIQUE_CARRIER STRING, AIRLINE_ID INT, CARRIER STRING, TAIL_NUM STRING, FL_NUM STRING, ORIGIN_AIRPORT_ID INT, ORIGIN_AIRPORT_SEQ_ID INT, ORIGIN STRING, DEST_AIRPORT_ID INT, DEST_AIRPORT_SEQ_ID INT, DEST STRING, DEP_DELAY FLOAT, ARR_DELAY FLOAT, CANCELLED FLOAT, DIVERTED FLOAT, DISTANCE FLOAT) PARTITIONED BY (MONTH TINYINT, DAY_OF_MONTH TINYINT) STORED AS PARQUET;

INSERT INTO TABLE flight_data_parquet PARTITION(MONTH = 1, DAY_OF_MONTH) SELECT F.YEAR, F.FL_DATE, F.UNIQUE_CARRIER, F.AIRLINE_ID, F.CARRIER, F.TAIL_NUM, F.FL_NUM, F.ORIGIN_AIRPORT_ID, F.ORIGIN_AIRPORT_SEQ_ID,  F.ORIGIN, F.DEST_AIRPORT_ID, F.DEST_AIRPORT_SEQ_ID, F.DEST, F.DEP_DELAY, F.ARR_DELAY, F.CANCELLED, F.DIVERTED, F.DISTANCE, F.DAY_OF_MONTH FROM flight_data_csv F WHERE F.YEAR != 'YEAR' AND F.MONTH = 1;

CREATE TABLE flight_data_parquet (YEAR INT, FL_DATE STRING, UNIQUE_CARRIER STRING, AIRLINE_ID INT, CARRIER STRING, TAIL_NUM STRING, FL_NUM INT, ORIGIN_AIRPORT_ID INT, ORIGIN_AIRPORT_SEQ_ID INT, ORIGIN STRING, DEST_AIRPORT_ID INT, DEST_AIRPORT_SEQ_ID INT, DEST STRING, DEP_DELAY FLOAT, ARR_DELAY FLOAT, CANCELLED FLOAT, DIVERTED FLOAT, DISTANCE FLOAT) PARTITIONED BY (MONTH TINYINT, DAY_OF_MONTH TINYINT) STORED AS PARQUET;

INSERT INTO TABLE flights.flight_data_parquet PARTITION(MONTH = 1, DAY_OF_MONTH) SELECT F.YEAR, F.FL_DATE, F.UNIQUE_CARRIER, F.AIRLINE_ID, F.CARRIER, F.TAIL_NUM, F.FL_NUM, F.ORIGIN_AIRPORT_ID, F.ORIGIN_AIRPORT_SEQ_ID,  F.ORIGIN, F.DEST_AIRPORT_ID, F.DEST_AIRPORT_SEQ_ID, F.DEST, F.DEP_DELAY, F.ARR_DELAY, F.CANCELLED, F.DIVERTED, F.DISTANCE, F.DAY_OF_MONTH FROM flights.flight_data_csv F WHERE F.YEAR != 'YEAR' AND F.MONTH = 1;
INSERT INTO TABLE flights.flight_data_parquet PARTITION(MONTH = 2, DAY_OF_MONTH) SELECT F.YEAR, F.FL_DATE, F.UNIQUE_CARRIER, F.AIRLINE_ID, F.CARRIER, F.TAIL_NUM, F.FL_NUM, F.ORIGIN_AIRPORT_ID, F.ORIGIN_AIRPORT_SEQ_ID,  F.ORIGIN, F.DEST_AIRPORT_ID, F.DEST_AIRPORT_SEQ_ID, F.DEST, F.DEP_DELAY, F.ARR_DELAY, F.CANCELLED, F.DIVERTED, F.DISTANCE, F.DAY_OF_MONTH FROM flights.flight_data_csv F WHERE F.YEAR != 'YEAR' AND F.MONTH = 2;
INSERT INTO TABLE flights.flight_data_parquet PARTITION(MONTH = 3, DAY_OF_MONTH) SELECT F.YEAR, F.FL_DATE, F.UNIQUE_CARRIER, F.AIRLINE_ID, F.CARRIER, F.TAIL_NUM, F.FL_NUM, F.ORIGIN_AIRPORT_ID, F.ORIGIN_AIRPORT_SEQ_ID,  F.ORIGIN, F.DEST_AIRPORT_ID, F.DEST_AIRPORT_SEQ_ID, F.DEST, F.DEP_DELAY, F.ARR_DELAY, F.CANCELLED, F.DIVERTED, F.DISTANCE, F.DAY_OF_MONTH FROM flights.flight_data_csv F WHERE F.YEAR != 'YEAR' AND F.MONTH = 3;
INSERT INTO TABLE flights.flight_data_parquet PARTITION(MONTH = 4, DAY_OF_MONTH) SELECT F.YEAR, F.FL_DATE, F.UNIQUE_CARRIER, F.AIRLINE_ID, F.CARRIER, F.TAIL_NUM, F.FL_NUM, F.ORIGIN_AIRPORT_ID, F.ORIGIN_AIRPORT_SEQ_ID,  F.ORIGIN, F.DEST_AIRPORT_ID, F.DEST_AIRPORT_SEQ_ID, F.DEST, F.DEP_DELAY, F.ARR_DELAY, F.CANCELLED, F.DIVERTED, F.DISTANCE, F.DAY_OF_MONTH FROM flights.flight_data_csv F WHERE F.YEAR != 'YEAR' AND F.MONTH = 4;

CREATE EXTERNAL TABLE flight_data_csv (YEAR INT, MONTH TINYINT, DAY_OF_MONTH TINYINT, FL_DATE STRING, UNIQUE_CARRIER STRING, AIRLINE_ID INT, CARRIER STRING, TAIL_NUM STRING, FL_NUM STRING, ORIGIN_AIRPORT_ID INT, ORIGIN_AIRPORT_SEQ_ID INT, ORIGIN STRING, DEST_AIRPORT_ID INT, DEST_AIRPORT_SEQ_ID INT, DEST STRING, DEP_DELAY FLOAT, ARR_DELAY FLOAT, CANCELLED FLOAT, DIVERTED FLOAT, DISTANCE FLOAT) ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde' WITH SERDEPROPERTIES ("separatorChar" = ",", "quoteChar" = "\"") LOCATION '/user/cloudera/flights/' TBLPROPERTIES("skip.header.line.count"="1");